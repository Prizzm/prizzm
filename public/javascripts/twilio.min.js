Twilio=typeof Twilio!="undefined"?Twilio:{};NS_MEDIASTREAM=NS_BEEP=NS_SOUND="Twilio";TWILIO_ROOT=typeof TWILIO_ROOT!="undefined"?TWILIO_ROOT:function(){for(var f=document.getElementsByTagName("script"),b=window.location.protocol||"http:",e=/(\w+:).*twilio\.(?:min\.)?js/,c=0;c<f.length;c++){var a=f[c].src.match(e);if(a){b=a[1]||b;break}}return b}()+"//static.twilio.com/libs/twiliojs/1.0/";
this.JSON||(JSON=function(){function f(c){return c<10?"0"+c:c}function b(c,a){var d,g,h,i;d=/["\\\x00-\x1f\x7f-\x9f]/g;var f;switch(typeof c){case "string":return d.test(c)?'"'+c.replace(d,function(a){var d=e[a];if(d)return d;d=a.charCodeAt();return"\\u00"+Math.floor(d/16).toString(16)+(d%16).toString(16)})+'"':'"'+c+'"';case "number":return isFinite(c)?String(c):"null";case "boolean":case "null":return String(c);case "object":if(!c)return"null";if(typeof c.toJSON==="function")return b(c.toJSON());
d=[];if(typeof c.length==="number"&&!c.propertyIsEnumerable("length")){i=c.length;for(g=0;g<i;g+=1)d.push(b(c[g],a)||"null");return"["+d.join(",")+"]"}if(a){i=a.length;for(g=0;g<i;g+=1)h=a[g],typeof h==="string"&&(f=b(c[h],a))&&d.push(b(h)+":"+f)}else for(h in c)typeof h==="string"&&(f=b(c[h],a))&&d.push(b(h)+":"+f);return"{"+d.join(",")+"}"}}Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+
":"+f(this.getUTCSeconds())+"Z"};var e={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:b,parse:function(c,a){function d(c,b){var g,e;if(b&&typeof b==="object")for(g in b)Object.prototype.hasOwnProperty.apply(b,[g])&&(e=d(g,b[g]),e!==void 0&&(b[g]=e));return a(c,b)}var b;if(/^[\],:{}\s]*$/.test(c.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return b=eval("("+
c+")"),typeof a==="function"?d("",b):b;throw new SyntaxError("parseJSON");}}}());
(function(f){f.Twilio=f.Twilio||{};f.Twilio._phpjs_atob=function(b){var e,c,a,d,g,h=0,i=0;d="";var f=[];if(!b)return b;b+="";do e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(h++)),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(h++)),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(h++)),g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(b.charAt(h++)),a=
e<<18|c<<12|d<<6|g,e=a>>16&255,c=a>>8&255,a&=255,d==64?f[i++]=String.fromCharCode(e):g==64?f[i++]=String.fromCharCode(e,c):f[i++]=String.fromCharCode(e,c,a);while(h<b.length);b=d=f.join("");h=[];e=f=g=d=i=0;for(b+="";i<b.length;)g=b.charCodeAt(i),g<128?(h[d++]=String.fromCharCode(g),i++):g>191&&g<224?(f=b.charCodeAt(i+1),h[d++]=String.fromCharCode((g&31)<<6|f&63),i+=2):(f=b.charCodeAt(i+1),e=b.charCodeAt(i+2),h[d++]=String.fromCharCode((g&15)<<12|(f&63)<<6|e&63),i+=3);return d=h.join("")};f.Twilio._phpjs_btoa=
function(b){var e,c,a,d,g=0,h=0,i="",i=[];if(!b)return b;b+="";if(b===null||typeof b==="undefined")b="";else{b+="";e="";c=a=d=0;d=b.length;for(var f=0;f<d;f++){var m=b.charCodeAt(f),l=null;m<128?a++:l=m>127&&m<2048?String.fromCharCode(m>>6|192)+String.fromCharCode(m&63|128):String.fromCharCode(m>>12|224)+String.fromCharCode(m>>6&63|128)+String.fromCharCode(m&63|128);l!==null&&(a>c&&(e+=b.slice(c,a)),e+=l,c=a=f+1)}a>c&&(e+=b.slice(c,d));b=e}do e=b.charCodeAt(g++),c=b.charCodeAt(g++),a=b.charCodeAt(g++),
d=e<<16|c<<8|a,e=d>>18&63,c=d>>12&63,a=d>>6&63,d&=63,i[h++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(a)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d);while(g<b.length);i=i.join("");switch(b.length%3){case 1:i=i.slice(0,-2)+"==";break;case 2:i=i.slice(0,-1)+"="}return i}})(window);
var swfobject=function(){function f(){if(!v){try{var a=k.getElementsByTagName("body")[0].appendChild(k.createElement("span"));a.parentNode.removeChild(a)}catch(d){return}v=!0;for(var a=A.length,c=0;c<a;c++)A[c]()}}function b(a){v?a():A[A.length]=a}function e(a){if(typeof p.addEventListener!=o)p.addEventListener("load",a,!1);else if(typeof k.addEventListener!=o)k.addEventListener("load",a,!1);else if(typeof p.attachEvent!=o)x(p,"onload",a);else if(typeof p.onload=="function"){var d=p.onload;p.onload=
function(){d();a()}}else p.onload=a}function c(){var d=k.getElementsByTagName("body")[0],c=k.createElement(s);c.setAttribute("type",B);var b=d.appendChild(c);if(b){var g=0;(function(){if(typeof b.GetVariable!=o){var h=b.GetVariable("$version");if(h)h=h.split(" ")[1].split(","),j.pv=[parseInt(h[0],10),parseInt(h[1],10),parseInt(h[2],10)]}else if(g<10){g++;setTimeout(arguments.callee,10);return}d.removeChild(c);b=null;a()})()}else a()}function a(){var a=t.length;if(a>0)for(var c=0;c<a;c++){var b=t[c].id,
e=t[c].callbackFn,f={success:!1,id:b};if(j.pv[0]>0){var m=q(b);if(m)if(C(t[c].swfVersion)&&!(j.wk&&j.wk<312)){if(w(b,!0),e)f.success=!0,f.ref=d(b),e(f)}else if(t[c].expressInstall&&g()){f={};f.data=t[c].expressInstall;f.width=m.getAttribute("width")||"0";f.height=m.getAttribute("height")||"0";if(m.getAttribute("class"))f.styleclass=m.getAttribute("class");if(m.getAttribute("align"))f.align=m.getAttribute("align");for(var n={},m=m.getElementsByTagName("param"),k=m.length,l=0;l<k;l++)m[l].getAttribute("name").toLowerCase()!=
"movie"&&(n[m[l].getAttribute("name")]=m[l].getAttribute("value"));h(f,n,b,e)}else i(m),e&&e(f)}else if(w(b,!0),e){if((b=d(b))&&typeof b.SetVariable!=o)f.success=!0,f.ref=b;e(f)}}}function d(a){var d=null;if((a=q(a))&&a.nodeName=="OBJECT")typeof a.SetVariable!=o?d=a:(a=a.getElementsByTagName(s)[0])&&(d=a);return d}function g(){return!D&&C("6.0.65")&&(j.win||j.mac)&&!(j.wk&&j.wk<312)}function h(a,d,c,b){D=!0;G=b||null;I={success:!1,id:c};var g=q(c);if(g){g.nodeName=="OBJECT"?(z=n(g),E=null):(z=g,E=
c);a.id=J;if(typeof a.width==o||!/%$/.test(a.width)&&parseInt(a.width,10)<310)a.width="310";if(typeof a.height==o||!/%$/.test(a.height)&&parseInt(a.height,10)<137)a.height="137";k.title=k.title.slice(0,47)+" - Flash Player Installation";b=j.ie&&j.win?"ActiveX":"PlugIn";b="MMredirectURL="+p.location.toString().replace(/&/g,"%26")+"&MMplayerType="+b+"&MMdoctitle="+k.title;typeof d.flashvars!=o?d.flashvars+="&"+b:d.flashvars=b;if(j.ie&&j.win&&g.readyState!=4)b=k.createElement("div"),c+="SWFObjectNew",
b.setAttribute("id",c),g.parentNode.insertBefore(b,g),g.style.display="none",function(){g.readyState==4?g.parentNode.removeChild(g):setTimeout(arguments.callee,10)}();m(a,d,c)}}function i(a){if(j.ie&&j.win&&a.readyState!=4){var d=k.createElement("div");a.parentNode.insertBefore(d,a);d.parentNode.replaceChild(n(a),d);a.style.display="none";(function(){a.readyState==4?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(n(a),a)}function n(a){var d=k.createElement("div");
if(j.win&&j.ie)d.innerHTML=a.innerHTML;else if(a=a.getElementsByTagName(s)[0])if(a=a.childNodes)for(var c=a.length,b=0;b<c;b++)!(a[b].nodeType==1&&a[b].nodeName=="PARAM")&&a[b].nodeType!=8&&d.appendChild(a[b].cloneNode(!0));return d}function m(a,d,b){var c,g=q(b);if(j.wk&&j.wk<312)return c;if(g){if(typeof a.id==o)a.id=b;if(j.ie&&j.win){var h="",e;for(e in a)if(a[e]!=Object.prototype[e])e.toLowerCase()=="data"?d.movie=a[e]:e.toLowerCase()=="styleclass"?h+=' class="'+a[e]+'"':e.toLowerCase()!="classid"&&
(h+=" "+e+'="'+a[e]+'"');e="";for(var f in d)d[f]!=Object.prototype[f]&&(e+='<param name="'+f+'" value="'+d[f]+'" />');g.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+h+">"+e+"</object>";F[F.length]=a.id;c=q(a.id)}else{f=k.createElement(s);f.setAttribute("type",B);for(var i in a)a[i]!=Object.prototype[i]&&(i.toLowerCase()=="styleclass"?f.setAttribute("class",a[i]):i.toLowerCase()!="classid"&&f.setAttribute(i,a[i]));for(h in d)d[h]!=Object.prototype[h]&&h.toLowerCase()!=
"movie"&&(a=f,e=h,i=d[h],b=k.createElement("param"),b.setAttribute("name",e),b.setAttribute("value",i),a.appendChild(b));g.parentNode.replaceChild(f,g);c=f}}return c}function l(a){var d=q(a);if(d&&d.nodeName=="OBJECT")j.ie&&j.win?(d.style.display="none",function(){if(d.readyState==4){var b=q(a);if(b){for(var c in b)typeof b[c]=="function"&&(b[c]=null);b.parentNode.removeChild(b)}}else setTimeout(arguments.callee,10)}()):d.parentNode.removeChild(d)}function q(a){var d=null;try{d=k.getElementById(a)}catch(b){}return d}
function x(a,d,b){a.attachEvent(d,b);y[y.length]=[a,d,b]}function C(a){var d=j.pv,a=a.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return d[0]>a[0]||d[0]==a[0]&&d[1]>a[1]||d[0]==a[0]&&d[1]==a[1]&&d[2]>=a[2]?!0:!1}function K(a,d,b,c){if(!j.ie||!j.mac){var g=k.getElementsByTagName("head")[0];if(g){b=b&&typeof b=="string"?b:"screen";c&&(H=r=null);if(!r||H!=b)c=k.createElement("style"),c.setAttribute("type","text/css"),c.setAttribute("media",b),r=g.appendChild(c),
j.ie&&j.win&&typeof k.styleSheets!=o&&k.styleSheets.length>0&&(r=k.styleSheets[k.styleSheets.length-1]),H=b;j.ie&&j.win?r&&typeof r.addRule==s&&r.addRule(a,d):r&&typeof k.createTextNode!=o&&r.appendChild(k.createTextNode(a+" {"+d+"}"))}}}function w(a,d){if(L){var b=d?"visible":"hidden";v&&q(a)?q(a).style.visibility=b:K("#"+a,"visibility:"+b)}}function M(a){return/[\\\"<>\.;]/.exec(a)!=null&&typeof encodeURIComponent!=o?encodeURIComponent(a):a}var o="undefined",s="object",B="application/x-shockwave-flash",
J="SWFObjectExprInst",p=window,k=document,u=navigator,N=!1,A=[function(){N?c():a()}],t=[],F=[],y=[],z,E,G,I,v=!1,D=!1,r,H,L=!0,j=function(){var a=typeof k.getElementById!=o&&typeof k.getElementsByTagName!=o&&typeof k.createElement!=o,d=u.userAgent.toLowerCase(),b=u.platform.toLowerCase(),c=b?/win/.test(b):/win/.test(d),b=b?/mac/.test(b):/mac/.test(d),d=/webkit/.test(d)?parseFloat(d.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,g=!+"\u000b1",h=[0,0,0],e=null;if(typeof u.plugins!=o&&typeof u.plugins["Shockwave Flash"]==
s){if((e=u.plugins["Shockwave Flash"].description)&&!(typeof u.mimeTypes!=o&&u.mimeTypes[B]&&!u.mimeTypes[B].enabledPlugin))N=!0,g=!1,e=e.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),h[0]=parseInt(e.replace(/^(.*)\..*$/,"$1"),10),h[1]=parseInt(e.replace(/^.*\.(.*)\s.*$/,"$1"),10),h[2]=/[a-zA-Z]/.test(e)?parseInt(e.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}else if(typeof p.ActiveXObject!=o)try{var f=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(f&&(e=f.GetVariable("$version")))g=!0,e=e.split(" ")[1].split(","),
h=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)]}catch(i){}return{w3:a,pv:h,wk:d,ie:g,win:c,mac:b}}();(function(){j.w3&&((typeof k.readyState!=o&&k.readyState=="complete"||typeof k.readyState==o&&(k.getElementsByTagName("body")[0]||k.body))&&f(),v||(typeof k.addEventListener!=o&&k.addEventListener("DOMContentLoaded",f,!1),j.ie&&j.win&&(k.attachEvent("onreadystatechange",function(){k.readyState=="complete"&&(k.detachEvent("onreadystatechange",arguments.callee),f())}),p==top&&function(){if(!v){try{k.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,
0);return}f()}}()),j.wk&&function(){v||(/loaded|complete/.test(k.readyState)?f():setTimeout(arguments.callee,0))}(),e(f)))})();(function(){j.ie&&j.win&&window.attachEvent("onunload",function(){for(var a=y.length,d=0;d<a;d++)y[d][0].detachEvent(y[d][1],y[d][2]);a=F.length;for(d=0;d<a;d++)l(F[d]);for(var b in j)j[b]=null;j=null;for(var c in swfobject)swfobject[c]=null;swfobject=null})})();return{registerObject:function(a,d,b,c){if(j.w3&&a&&d){var g={};g.id=a;g.swfVersion=d;g.expressInstall=b;g.callbackFn=
c;t[t.length]=g;w(a,!1)}else c&&c({success:!1,id:a})},getObjectById:function(a){if(j.w3)return d(a)},embedSWF:function(a,d,c,e,f,i,n,l,k,q){var x={success:!1,id:d};j.w3&&!(j.wk&&j.wk<312)&&a&&d&&c&&e&&f?(w(d,!1),b(function(){c+="";e+="";var b={};if(k&&typeof k===s)for(var j in k)b[j]=k[j];b.data=a;b.width=c;b.height=e;j={};if(l&&typeof l===s)for(var p in l)j[p]=l[p];if(n&&typeof n===s)for(var r in n)typeof j.flashvars!=o?j.flashvars+="&"+r+"="+n[r]:j.flashvars=r+"="+n[r];if(C(f))p=m(b,j,d),b.id==
d&&w(d,!0),x.success=!0,x.ref=p;else if(i&&g()){b.data=i;h(b,j,d,q);return}else w(d,!0);q&&q(x)})):q&&q(x)},switchOffAutoHideShow:function(){L=!1},ua:j,getFlashPlayerVersion:function(){return{major:j.pv[0],minor:j.pv[1],release:j.pv[2]}},hasFlashPlayerVersion:C,createSWF:function(a,d,b){if(j.w3)return m(a,d,b)},showExpressInstall:function(a,d,b,c){j.w3&&g()&&h(a,d,b,c)},removeSWF:function(a){j.w3&&l(a)},createCSS:function(a,d,b,c){j.w3&&K(a,d,b,c)},addDomLoadEvent:b,addLoadEvent:e,getQueryParamValue:function(a){var d=
k.location.search||k.location.hash;if(d){/\?/.test(d)&&(d=d.split("?")[1]);if(a==null)return M(d);for(var d=d.split("&"),b=0;b<d.length;b++)if(d[b].substring(0,d[b].indexOf("="))==a)return M(d[b].substring(d[b].indexOf("=")+1))}return""},expressInstallCallback:function(){if(D){var a=q(J);if(a&&z){a.parentNode.replaceChild(z,a);if(E&&(w(E,!0),j.ie&&j.win))z.style.display="block";G&&G(I)}D=!1}}}}();
(function(f){function b(){this.__id=b.__nextId++;var a=function(){};this.onclose=this.onerror=this.onopen=a;b.__instances[this.__id]=this}if(swfobject.hasFlashPlayerVersion("10.0.0")){b.prototype={open:function(){var a=this,c=Array.prototype.slice.call(arguments);b.__queue(function(){b.__flash.open.apply(b.__flash,[a.__id].concat(c))})},exec:function(){var a=this,c=Array.prototype.slice.call(arguments);b.__queue(function(){b.__flash.exec.apply(b.__flash,[a.__id].concat(c))})},close:function(){var a=
this;b.__queue(function(){b.__flash.close(a.__id)})},play:function(){var a=this,c=Array.prototype.slice.call(arguments);b.__queue(function(){b.__flash.playStream.apply(b.__flash,[a.__id].concat(c))})},publish:function(a,c){var h=this;b.__queue(function(){b.__flash.publish(h.__id,a,c)})},attachAudio:function(a){var c=this;b.__queue(function(){b.__flash.attachAudio(c.__id,a)})},detachAudio:function(){var a=this;b.__queue(function(){b.__flash.detachAudio(a.__id)})},__handleEvent:function(a){switch(a.type){case "gatewayError":case "securityError":case "asyncError":case "ioError":this.onerror.call(this,
a);break;case "netStatus":this.__handleNetStatus(a)}},__handleNetStatus:function(a){b.log("Event info code: "+a.info.code);switch(a.info.code){case "NetConnection.Connect.Failed":case "NetConnection.Connect.Rejected":b.log("Connection failed or was rejected");this.onerror.call(this,a);break;case "NetConnection.Connect.Closed":b.log("Connection closed");this.onclose.call(this,a);break;case "NetConnection.Connect.Success":b.log("Connection established");this.onopen.call(this);break;default:b.log("Unexpected event: "+
a.info.code)}}};var e={__queue:function(a){b.initialized?a():b.__tasks.push(a)},initialize:function(a){if(!b.__flash){a=a||{};a.swfLocation=a.swfLocation||"MediaStreamMain.swf";a.domId=a.domId||"__connectionFlash__";var c=document.createElement("div");c.id=a.domId;if(a.loader)a.loader.call(null,c);else{var h=document.createElement("div");h.style.position="absolute";h.appendChild(c);document.body.appendChild(c)}b.__flash=c;var e={};"objectEnc"in a&&(e.objectEnc=a.objectEnc);e.namespace=window.NS_MEDIASTREAM?
window.NS_MEDIASTREAM+".MediaStream":"MediaStream";c=function(){swfobject.embedSWF(a.swfLocation,a.domId,"215","138","10.0.0",null,e,{hasPriority:!0,allowScriptAccess:"always"},null,function(a){b.log("Embed "+(a.success?"succeeded":"failed"))})};document.body?c():window.addEventListener?window.addEventListener("load",c,!1):window.attachEvent("onload",c)}},setMicrophoneGain:function(a){b.__queue(function(){try{b.__flash.setMicrophoneGain(a)}catch(c){b.log(c)}})},setMicrophone:function(a){b.__queue(function(){b.__flash.setMicrophone(a)})},
getMicrophone:function(){return b.initialized?b.__flash.getMicrophone():null},getMicrophones:function(){return b.initialized?b.__flash.getMicrophones():[]},setUseEchoSuppression:function(a){b.__queue(function(){try{b.__flash.setUseEchoSupression(a)}catch(c){b.log(c)}})},setSilenceLevel:function(a,c){b.__queue(function(){try{b.__flash.setSilenceLevel(a,c)}catch(h){b.log(h)}})},showSettings:function(){b.__queue(function(){b.__flash.showSettings()})},isMicMuted:function(){try{return b.__flash.isMicMuted()}catch(a){if(!(a instanceof
TypeError))throw a;}},log:function(a,c,h){if(b.__debug&&window.console&&(h=h||"log",console[h]("[MediaStream] "+a),typeof c!="undefined"))console[h](c)}},c={__onFlashInitialized:function(){b.initialized=!0;b.__flash=document.getElementById(b.__flash.id);setTimeout(function(){b.__flash.setDebug(b.__debug);b.setMicrophone(-1);var a=b.getMicrophone();b.log(a?"Using "+a:"No mics available");b.setMicrophoneGain(75);for(a=0;a<b.__tasks.length;a++)b.__tasks[a].call()},0)},__onMediaStreamEvent:function(){setTimeout(function(){for(var a=
b.__flash.dequeueEvents(),c=0;c<a.length;c++)try{b.log("Received event: "+a[c].type),b.__instances[a[c].mediaStreamId].__handleEvent(a[c])}catch(h){b.log("Error while processing "+a[c].type+": "+h.message,h,"error")}},0)},__onLog:function(a){a.level=="error"?b.log(a.message,void 0,"error"):b.log(a.message)}},a;for(a in e)b[a]=e[a];for(a in c)b[a]=c[a];b.__nextId=0;b.__flash=null;b.__instances={};b.__tasks=[];b.__debug=!1;b.initialized=!1;b.AMF0=0;b.AMF3=3;f.MediaStream=b}else window.console&&console.error("Flash Player >= 10.0.0 is required.")})(window[window.NS_MEDIASTREAM]||
window);
(function(f){function b(c){if(!(this instanceof b))return new b(c);if(typeof c!="number"||c<1)return null;this.channels=1;this.bitdepth=16;this.samplerate=c;this.sine=[];for(var a=2*Math.PI/parseFloat(c),d=0;d<c;d++)this.sine.push(Math.sin(d*a))}var e={amplify:function(c){return function(a){return a*c}},ushort:function(c){return String.fromCharCode(255&c,255&c>>8)},ulong:function(c){return String.fromCharCode(255&c,255&c>>8,255&c>>16,255&c>>24)},gcd:function(c,a){for(;a;)var b=c,c=a,a=b%a;return c},
lcm:function(b,a){return Math.floor(b*a/e.gcd(b,a))},compose:function(b){return function(a){for(var d=0;d<b.length;d++)a=b[d](a);return a}},map:function(b,a){for(var d=[],g=0;g<a.length;g++)d.push(b.call(this,a[g]));return d},getattr:function(b){return function(a){return a[b]}},zip:function(){if(arguments.length==0)return[];for(var b=Array.prototype.slice.call(arguments),a=[],d=Math.min.apply(null,e.map(e.getattr("length"),b)),g=0;g<d;g++)a.push(e.map(e.getattr(g),b));return a},sum:function(b){return e.foldl(function(a,
b){return a+b},b)},bind:function(b,a){return function(){var d=Array.prototype.slice.call(arguments);return a.apply(b,d)}},foldl:function(b,a){if(a.length==1)return a[0];for(var d=b(a[0],a[1]),g=2;g<a.length;g++)d=b(d,a[g]);return d},mulmod:function(b,a,d){return b*a%d},range:function(b){for(var a=[],d=0;d<b;d++)a.push(d);return a}};b.prototype={generate:function(b){var b=b instanceof Array?b:[b],a=e.bind(this,e.map),d=a(function(a){return e.lcm(this.samplerate,a)/a},b),d=e.foldl(e.lcm,d),g=function(a){return function(b){return this.sine[e.mulmod(a,
b,this.samplerate)]}};return a(function(d){return e.sum(a(g(d),b))},e.range(d))},encode:function(c,a,d){c=c instanceof Array?c:[c];d=e.compose((d||[]).concat([e.ushort]));c=e.map(d,this.generate(c));c=Array(Math.ceil(a*this.samplerate/c.length)+1).join(c.join("")).substr(0,this.samplerate*a*2);a=["fmt ",e.ulong(b.PCM_CHUNK_SIZE),e.ushort(b.LINEAR_QUANTIZATION),e.ushort(this.channels),e.ulong(this.samplerate),e.ulong(this.samplerate*this.channels*this.bitdepth/8),e.ushort(this.bitdepth/8),e.ushort(this.bitdepth)].join("");
c=["data",e.ulong(c.length*this.channels*this.bitdepth/8),c].join("");return[["RIFF",e.ulong(4+(8+a.length)+(8+c.length)),"WAVE"].join(""),a,c].join("")},play:function(b,a,d){d=d||[];b=btoa(this.encode(b,a,d));a=document.createElement("audio");a.src="data:audio/x-wav;base64,"+b;a.play()}};b.LINEAR_QUANTIZATION=1;b.PCM_CHUNK_SIZE=16;b.utils=e;f.Beep=b})(window[window.NS_BEEP]||window);
(function(f){function b(){this.id=b.nextId++;b.items[this.id]=this;this.create()}swfobject.hasFlashPlayerVersion("10.0.0")||window.console&&console.error("Flash Player >= 10.0.0 is required");b.prototype={create:function(){var a=this.id;b.queue(function(){b.flash.__create(a)})},play:function(a,c){var a=a||0,c=c||0,h=this.id;b.queue(function(){b.flash.__play(h,a,c)})},load:function(a){var c=this.id;b.queue(function(){b.flash.__load(c,a)})},stop:function(){var a=this.id;b.queue(function(){b.flash.__stop(a)})},
destroy:function(){var a=this.id;b.queue(function(){b.flash.__destroy(a);delete b.items[a]})}};var e={initialize:function(a){a=a||{};a.swfLocation=a.swfLocation||"SoundMain.swf";a.domId=a.domId||"__soundFlash__";if(!b.flash)if(document.body){var c=document.createElement("div");c.id=a.domId;document.body.appendChild(c);b.flash=c;swfobject.embedSWF(a.swfLocation,a.domId,"1","1","10.0.0",null,{namespace:window.NS_SOUND?window.NS_SOUND+".Sound":"Sound"},{hasPriority:!0,allowScriptAccess:"always"},null,
function(a){b.log("Embed "+(a.success?"succeeded":"failed"))})}else try{window.addEventListener("load",function(){b.initialize(a)},!1)}catch(h){window.attachEvent("onload",function(){b.initialize(a)})}},log:function(a,c,h){if(b.debug&&window.console&&(h=h||"log",console[h]("[Sound] "+a),typeof c!="undefined"))console[h](c)},queue:function(a){b.initialized?a():b.tasks.push(a)}},c={__onFlashInitialized:function(){b.initialized=!0;b.flash=document.getElementById(b.flash.id);setTimeout(function(){b.flash.__setDebug(b.debug);
b.log("Initialized and ready");for(var a=0;a<b.tasks.length;a++)b.tasks[a]()},0)},__onLog:function(a){b.log(a)}},a;for(a in e)b[a]=e[a];for(a in c)b[a]=c[a];b.nextId=0;b.debug=!1;b.tasks=[];b.items={};f.Sound=b})(window[window.NS_SOUND]||window);
(function(f){function b(a){return function(){var b=Array.prototype.slice.call(arguments,0);a.memo=a.memo||{};return a.memo[b]?a.memo[b]:a.memo[b]=a.apply(null,b)}}function e(a){a=a.split(".");if(a.length!=3)throw new f.Exception("Wrong number of segments");return d(a[1])}function c(a){if(a=="")return{};if(a.indexOf("&")==-1&&a.indexOf("=")==-1)return a;for(var a=a.split("&"),b={},d=0;d<a.length;d++){var g=a[d].split("=");b[g[0]]=c(decodeURIComponent(g[1]))}return b}function a(b){if(!(this instanceof
a))return new a(b);this.message=b}var d=b(function(a){var b=a.length%4;b>0&&(a+=Array(4-b+1).join("="));a=a.replace(/-/g,"+").replace(/_/g,"/");a=f.atob(a);return JSON.parse(a)}),g=b(function(a){for(var a=e(a),b=a.scope.split(" "),d={},g=0;g<b.length;g++){var l;l=b[g].match(/^scope:(\w+):(\w+)\??(.*)$/);if(!(l&&l.length==4))throw new f.Exception("Bad scope URI");l={service:l[1],privilege:l[2],params:c(l[3])};d[l.service+":"+l.privilege]=l}a.scope=d;return a});a.prototype.toString=function(){return"Twilio.Exception: "+
this.message};f.Exception=a;f.decode=e;f.btoa=function(a){try{return btoa(a)}catch(b){return f._phpjs_btoa(a)}};f.atob=function(a){try{return atob(a)}catch(b){return f._phpjs_atob(a)}};f.decorate=function(){var a=Array.prototype.slice.call(arguments),b=a.shift(),c=a.shift();if(b&&c){for(var d=b[c],g=0;g<a.length;g++)d=(0,a[g])(d);b[c]=d}};f.objectize=g;f.urlencode=function(a,b){var c=[],b=b||!1,d;for(d in a)if(b&&a[d]instanceof Array)for(var g in a[d]){var e=a[d][g];c.push(encodeURIComponent(d)+"="+
encodeURIComponent(e))}else e=a[d],c.push(encodeURIComponent(d)+"="+encodeURIComponent(e));return c.join("&")}})(Twilio);
(function(f){function b(b,a){return function(){var d=Array.prototype.slice(arguments);a.apply(b,d)}}function e(){if(!(this instanceof e))return new e;this.cache={}}e.prototype={add:function(b,a,d){d=d||{};if(!(d instanceof Object))throw new TypeError("Bad envelope type; expected Object");!(a instanceof Array)&&(a=[a]);for(var g=0;g<a.length;g++)if(!(a[g]instanceof f.Sound))throw new TypeError("Expected an instance of Twilio.Sound");this.cache[b]={starttime:null,sounds:a,envelope:d}},play:function(b,
a,d){a=a||0;d=d||1;if(b in this.cache){for(var b=this.cache[b],g=0;g<b.sounds.length;g++)b.sounds[g].play(a,d);b.starttime=(new Date).getTime()}},stop:function(b){if(b in this.cache){var a=this.cache[b],b=a.envelope.release||0,d=function(){for(var b=0;b<a.sounds.length;b++)a.sounds[b].stop()},g=(new Date).getTime(),g=Math.max(0,b-(g-a.starttime));b==0?d():setTimeout(d,g)}},playseq:function(){var c=null,a=[],d=function(){var g=a.shift();if(g){var e=g[0],i=g[1]||0,g=g[2]||0;e in this.cache&&f.Device.instance.soundcache.play(e);
c=window.setTimeout(b(this,d),i+g)}else c=null};return function(g){for(var e=0;e<g.length;e++)a.push(g[e]);c==null&&(c=window.setTimeout(b(this,d),0))}}()};f.SoundCache=e})(Twilio);
(function(f){function b(e){if(!(this instanceof b))return new b(e);var e=e||{},c=function(){},c={interval:10,onsleep:c,onwakeup:c},a;for(a in c)a in e||(e[a]=c[a]);this.interval=e.interval;this.lastbeat=0;this.pintvl=null;this.onsleep=e.onsleep;this.onwakeup=e.onwakeup}b.toString=function(){return"[Twilio.Heartbeat class]"};b.prototype={toString:function(){return"[Twilio.Heartbeat instance]"},beat:function(){this.lastbeat=(new Date).getTime();if(this.sleeping()){if(this.onwakeup)this.onwakeup();this.pintvl=
window.setInterval(function(b){return function(){b.check()}}(this),this.interval*1E3)}},check:function(){var b=(new Date).getTime()-this.lastbeat;if(!this.sleeping()&&b>this.interval*1E3){if(this.onsleep)this.onsleep();window.clearInterval(this.pintvl);this.pintvl=null}},sleeping:function(){return this.pintvl==null}};f.Heartbeat=b})(Twilio);
(function(f){f.mixinLog=function(b,e){function c(){if(c.enabled)for(var a=c.prefix?c.prefix+" ":"",b=0;b<arguments.length;b++){var g=arguments[b];c.handler(typeof g=="string"?a+g:g)}}c.enabled=!0;c.prefix=e||"";c.defaultHandler=function(a){window.console&&console.log(a)};c.handler=c.defaultHandler;b.log=c}})(Twilio);
(function(f){function b(b,a,d){a=a||[];if(a.length==0)return-1;if(!d&&a.indexOf)return a.indexOf(b);else{for(d=0;d<a.length;d++)if(a[d]===b)return d;return-1}}var e={addListener:function(b,a){if(typeof a!="function")throw new f.Exception("Listener must be a function, not "+typeof a);this.handlers[b]=this.handlers[b]||[];this.handlers[b].push(a);this.log('Registered listener for event type "'+b+'"');return this},hasListener:function(c,a){return b(a,this.handlers[c])!=-1},removeListener:function(c,
a){var d=b(a,this.handlers[c]);d>-1&&(this.handlers[c].splice(d,1),this.log('Removed listener for event type "'+c+'"'));return this},fire:function(){var b=Array.prototype.slice.call(arguments,0),a=b.shift(),d=this.handlers[a]||[];this.log('Invoke listeners for event type "'+a+'"');for(a=0;a<d.length;a++)d[a].apply(this,b)}};f.mixinEventEmitter=function(b){b.handlers=b.handlers||{};b.log=b.log||function(){};for(name in e)b[name]||(b[name]=function(a,b){return function(){var c=Array.prototype.slice.call(arguments,
0);return e[b].apply(a,c)}}(b,name))}})(Twilio);
(function(f){function b(b,a){if(!b.fire||!b.addListener)throw new f.Exception("Object is not event savvy");return function(){var d=Array.prototype.slice.call(arguments,0);return typeof d[0]=="function"?b.addListener(a,d[0]):(d.unshift(a),b.fire.apply(b,d))}}function e(c,a){if(!(this instanceof e))return new e(c,a);var d={logPrefix:"[EventStream]",socketFactory:null,scheme:"wss",host:"stream.twilio.com",swfLocation:TWILIO_ROOT+"WebSocket.swf",socket:null,reconnect:!0,url:null,flashTimeout:5E3,filters:{},
debug:!1},a=a||{},g;for(g in d)g in a||(a[g]=d[g]);this.options=a;this.token=c||"";this.handlers={};this.status="offline";f.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;if(!e.initializingFlash)if(document.body)e.initializeFlash(this);else{var h=this;window.addEventListener?window.addEventListener("load",function(){e.initializeFlash(h)},!1):window.attachEvent("onload",function(){e.initializeFlash(h)})}this.heartbeat=new f.Heartbeat({interval:15});this._connect();f.mixinEventEmitter(this);
d=["incoming","ready","offline","sms","call","twiml","error"];for(g=0;g<d.length;g++)this[d[g]]=b(this,d[g]);h=this;this.addListener("publish",function(a){h.fire("twiml",a)})}e.initializingFlash=!1;e.initializeFlash=function(b){if(!e.initializingFlash&&(e.initializingFlash=!0,window.WebSocket&&window.WebSocket.__initialize))WEB_SOCKET_SWF_LOCATION=b.options.swfLocation,window.WebSocket.__initialize(),b.log("Waiting "+b.options.flashTimeout+"ms for flash to initialize"),window.setTimeout(function(){window.WebSocket.__flash||
b.log("WebSocket did not initialize")},b.options.flashTimeout)};e.toString=function(){return"[Twilio.EventStream class]"};e.prototype={toString:function(){return"[Twilio.EventStream instance]"},destroy:function(){this.socket.close();this.heartbeat.onsleep=null;this.options.reconnect=!1;return this},_connect:function(){var b=this,a=this._extractUrl();a?(this.log("Attempting to connect to "+a+"..."),this.socket=this.options.socketFactory?this.options.socketFactory(a):new WebSocket(a),this.socket.onopen=
function(){b.log("Socket opened... sending ready signal");b.socket.send(JSON.stringify({"rt.message":"listen","rt.token":b.token}))},this.socket.onerror=function(a){a.data?b.fire("error",{message:a.data.message||"",code:a.data.code||""}):b.log("Received message event:",a)},this.socket.onmessage=function(a){b.heartbeat.beat();if(a.data!="\n")for(var a=typeof a.data!="string"?"":a.data.trim?a.data.trim():a.data.replace(/^\s+|\s+$/g,""),a=a.length==0?[]:a.split("\n"),g=0;g<a.length;g++){var e=JSON.parse(a[g]);
if(e["rt.message"]=="ready")b.status="ready",b.fire("ready",b);else{var f=e["rt.message"]||e.EventType;f!="incoming"&&b.fire("incoming",e);b.fire(f,e)}}},this.socket.onclose=function(){b.log("Gone offline");b.status="offline";b.fire("offline",b)},this.heartbeat.onsleep=function(){b.socket.close();b._tryReconnect(5E3)}):this.log("Nothing to do")},_extractUrl:function(){if(this.options.url)return this.options.url;var b=f.objectize(this.token).scope;if(!("stream:subscribe"in b))return null;var b=b["stream:subscribe"],
b=b.params&&b.params.path?b.params.path:"/",a=this.options.filters;a.AccessToken=this.token;return this.options.scheme+"://"+this.options.host+b+"?"+f.urlencode(a,!0)},_tryReconnect:function(b){var a=(new Date).getTime()/1E3|0;if(this.options.reconnect&&!(f.decode(this.token).exp<a||this._extractUrl()==null)){b=b||5E3;this._connect();var d=function(a){return function(){a._tryReconnect(b*2)}}(this),a=function(a){return function(){a.socket.readyState==2&&window.setTimeout(d,b)}}(this);window.setTimeout(a,
5E3)}}};e=function(b){var a=[],d=function(d){if(b.instance)return d();a.push(d)},g={instance:null,status:"offline",setup:function(d,g){b.instance=new b(d,g);for(var e=0;e<a.length;e++)a[e]();b.ready(function(){b.status="ready"});b.offline(function(){b.status="offline"});return b},incoming:function(a){d(function(){b.instance.incoming(a)});return b},ready:function(a){d(function(){b.instance.ready(a)});return b},offline:function(a){d(function(){b.instance.offline(a)});return b},sms:function(a){d(function(){b.instance.sms(a)});
return b},call:function(a){d(function(){b.instance.call(a)});return b},twiml:function(a){d(function(){b.instance.twiml(a)});return b},error:function(a){d(function(){b.instance.error(a)});return b}},e;for(e in g)b[e]=g[e];return b}(e);WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0;f.EventStream=e})(Twilio);
(function(f){function b(a,b){if(!a)return b;var c=b.match(/^(\w+):\/\/([^/]*)(.*)?/);if(!c)return b;var e=c[1],i=c[2],c=c[3];if(!/twilio.com$/.test(i.split(":")[0]))return b;var n=f.decode(a).iss;return!n?b:e+"://"+n.toLowerCase()+"."+i+c}function e(a,d,c){if(!(this instanceof e))return new e(d,c);this.device=a;this.message=d||{};var c=c||{},a={logPrefix:"[Connection]",bridgeToken:null,chunder:"chunder.prod.twilio.com",debug:!1,mediaStream:null,swfLocation:b(c.token,TWILIO_ROOT)+"MediaStreamMain.swf",
loader:function(a){e.dialog.insert(a)},token:null,objectEnc:f.MediaStream.AMF0},h;for(h in a)h in c||(c[h]=a[h]);this.options=c;this.parameters={};this._status=this.options.bridgeToken?"pending":"closed";f.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;f.mixinEventEmitter(this);if(!f.MediaStream.initialized)f.MediaStream.__debug=this.options.debug,f.MediaStream.setSilenceLevel(0,200),f.MediaStream.initialize({swfLocation:this.options.swfLocation,domId:"__mediaStreamContainer__",
loader:this.options.loader,objectEnc:this.options.objectEnc});this.mediaStream=this.options.mediaStream||new f.MediaStream;var i=this;this.mediaStream.onerror=function(a){var b={code:a.info.code,message:a.info.message,info:a.info};i.log("Received an error from MediaStream:",a);i.fire("error",b)};this.mediaStream.onopen=function(){i._status="open";i.fire("accept",i);i.mediaStream.publish("input","live");i.mediaStream.attachAudio();i.mediaStream.play("output")};this.mediaStream.onclose=function(){i._status=
"closed";i.device.sounds.disconnect()&&i.device.soundcache.play("disconnect");i.fire("disconnect",i)}}function c(){var a=document.createElement("div"),b=document.createElement("div"),c=document.createElement("button");a.style.position="fixed";a.style.zIndex="99999";a.style.top="0";a.style.left="0";a.style.width="1px";a.style.height="1px";a.style.overflow="hidden";a.style.visibility="hidden";b.style.margin="10% auto 0";b.style.width="215px";b.style.borderRadius="8px";b.style.backgroundColor="#f8f8f8";
b.style.border="8px solid rgb(160, 160, 160)";var e=this,f=function(){e.hide();e.closeCb&&e.closeCb.call()};c.appendChild(document.createTextNode("Close"));window.addEventListener?c.addEventListener("click",f,!1):c.attachEvent("onclick",f);a.appendChild(b);b.appendChild(c);this.screen=a;this.dialog=b;this.close=c;this.container=null;document.body?document.body.appendChild(a):(b=function(){document.body.appendChild(a)},window.addEventListener?window.addEventListener("load",b,!1):window.attachEvent("onload",
b))}e.toString=function(){return"[Twilio.Connection class]"};e.prototype={toString:function(){return"[Twilio.Connection instance]"},sendDigits:function(a){if(a.match(/[^0-9*#w]/))throw new f.Exception("Illegal character passed into sendDigits");this.mediaStream.exec("sendDTMF",a);for(var b=[],c=0;c<a.length;c++){var e=a[c]!="w"?"dtmf"+a[c]:"";e=="dtmf*"&&(e="dtmfs");e=="dtmf#"&&(e="dtmfh");b.push([e,200,20])}this.device.soundcache.playseq(b)},status:function(){return this._status},mute:function(){this.mediaStream.detachAudio()},
unmute:function(){this.mediaStream.attachAudio()},accept:function(a){if(typeof a=="function")return this.addListener("accept",a);var b=this;this._showMicDialogIfMuted(function(){if(f.MediaStream.isMicMuted())b._die("Access to microphone has been denied");else{var a=[],c;for(c in b.message)a.push(c+"="+encodeURIComponent(b.message[c]));b.mediaStream.open("rtmp://"+b.options.chunder+"/chunder",b.options.token,b.options.bridgeToken,a.join("&"))}})},cancel:function(a){if(typeof a=="function")return this.addListener("cancel",
a);this._status="closed";this.fire("cancel")},disconnect:function(a){if(typeof a=="function")return this.addListener("disconnect",a);this._status=="open"&&(this.log("Disconnecting..."),this.mediaStream.close())},error:function(a){if(typeof a=="function")return this.addListener("error",a)},_showMicDialogIfMuted:function(a){var b=this;f.MediaStream.__queue(function(){f.MediaStream.getMicrophones().length==(f.Connection.NO_MIC_LEVEL||0)?b._die("No microphone is available"):f.MediaStream.isMicMuted()?
(e.dialog.show(a),f.MediaStream.showSettings()):a.call()})},_die:function(a){this._status="pending";this.fire("error",new f.Exception(a))}};c.prototype={insert:function(a){if(this.container){if(this.container==a)return;this.dialog.removeChild(this.container)}this.container=a;this.dialog.insertBefore(a,this.close)},show:function(a){this.closeCb=a;this.screen.style.width="100%";this.screen.style.height="auto";this.screen.style.visibility="visible";this.container.style.marginLeft=window.outerWidth%2==
0?"0":"0.5px"},hide:function(){this.screen.style.width="1px";this.screen.style.height="1px";this.screen.style.visibility="hidden"}};e.dialog=new c;f.Connection=e})(Twilio);
(function(f){function b(a){if(!(this instanceof b))return new b(a);this.__dict__={};var a=a||{},d;for(d in a)this[d]=this.makeprop(this.__dict__,d),this[d](a[d])}function e(a,d){if(!(this instanceof e))return new e(a,d);var c={logPrefix:"[Device]",host:"chunder.twilio.com",eventsScheme:"wss",eventsHost:"matrix.twilio.com",soundSwfLocation:TWILIO_ROOT+"SoundMain.swf",connectionFactory:null,connectionOptions:{},stream:null,debug:!1,objectEnc:f.MediaStream.AMF0},d=d||{},h;for(h in c)h in d||(d[h]=c[h]);
this.options=d;this.token=a||"";this._status="offline";this.connections=[];this.stream=null;this.sounds=new b({incoming:!0,outgoing:!0,disconnect:!0});this.soundcache=new f.SoundCache;var c={incoming:"sounds/incoming.mp3",outgoing:"sounds/outgoing.mp3",disconnect:"sounds/disconnect.mp3",dtmf1:"sounds/dtmf-1.mp3",dtmf2:"sounds/dtmf-2.mp3",dtmf3:"sounds/dtmf-3.mp3",dtmf4:"sounds/dtmf-4.mp3",dtmf5:"sounds/dtmf-5.mp3",dtmf6:"sounds/dtmf-6.mp3",dtmf7:"sounds/dtmf-7.mp3",dtmf8:"sounds/dtmf-8.mp3",dtmf9:"sounds/dtmf-9.mp3",
dtmf0:"sounds/dtmf-0.mp3",dtmfs:"sounds/dtmf-star.mp3",dtmfh:"sounds/dtmf-hash.mp3"},i;for(i in c)h=new f.Sound,h.load(TWILIO_ROOT+c[i]),this.soundcache.add(i,h);this.soundcache.cache.incoming.envelope.release=2E3;f.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;f.mixinEventEmitter(this);f.Sound.debug=this.options.debug;f.Sound.initialize({swfLocation:this.options.soundSwfLocation});var n=this;this.incoming(function(a){a.accept(function(){n.soundcache.stop("incoming")});
a.addListener("cancel",function(){n.soundcache.stop("incoming")});n.sounds.incoming()&&n.soundcache.play("incoming",0,1E3)});this.register(this.token)}function c(a,b,c,e,i){var n={objectEnc:a.options.objectEnc,chunder:a.options.host,debug:a.options.debug},i=i||{},m;for(m in n)m in i||(i[m]=n[m]);c=="bridge"?(i.bridgeToken=b,i.token=null):c=="jwt"?(i.bridgeToken=null,i.token=b):this.log("Unknown token type: "+c);a.options.mediaStreamSwfLocation&&(i.swfLocation=a.options.mediaStreamSwfLocation);var l=
a.options.connectionFactory?a.options.connectionFactory(a,e,i):new f.Connection(a,e,i);l.accept(function(){a.fire("connect",l)}).error(function(b){a.fire("error",b);if(l.status()=="pending")for(var b=[].concat(a.connections),d=0;d<b.length;d++)l==b[d]&&a.connections.splice(d,1)}).cancel(function(){a.log("Canceled: "+l.parameters.CallSid);for(var b=[].concat(a.connections),d=0;d<b.length;d++)l==b[d]&&a.connections.splice(d,1);a.fire("cancel",l)}).disconnect(function(){a.fire("disconnect",l);for(var b=
[].concat(a.connections),d=0;d<b.length;d++)l==b[d]&&a.connections.splice(d,1)});return l}b.prototype={makeprop:function(a,b){return function(c){return typeof c=="undefined"?a[b]:a[b]=c}}};e.toString=function(){return"[Twilio.Device class]"};e.prototype={toString:function(){return"[Twilio.Device instance]"},register:function(a){var b=!("client:incoming"in f.objectize(a).scope)?null:[this.options.eventsScheme+"://"+this.options.eventsHost,"2010-04-01",f.objectize(a).iss,f.objectize(a).scope["client:incoming"].params.clientName].join("/")+
"?AccessToken="+a,e=this;if(b)this.stream?(this.log("Resetting stream url to: "+b),this.stream.socket.close(),this.stream.token=a,this.stream._tryReconnect()):(this.log("Registering to stream with url: "+b),b={logPrefix:"[Matrix]",debug:this.options.debug,url:b},this.stream=this.options.stream||f.EventStream(a,b),this.stream.ready(function(){e.log("Stream is ready");e._status="ready";e.fire("ready",e)}).offline(function(){e.log("Stream is offline");e._status="offline";e.fire("offline",e)}).error(function(a){e.log("Received error: ",
a);e.fire("error",a)}).incoming(function(a){e.log("Message incoming...",a);switch(a.Request){case "invite":if(!a.Token){e.fire("error",{message:"Received invite without a Token"});break}if(!a.CallSid){e.fire("error",{message:"Received invite without a CallSid"});break}var b=a.Parameters||{},a=c(e,a.Token,"bridge");a.parameters=b;e.connections.push(a);e.fire("incoming",a);break;case "cancel":for(var b=[].concat(e.connections),d=0;d<b.length;d++){var f=b[d];f.parameters.CallSid==a.CallSid&&f.status()==
"pending"&&f.cancel()}}}));else{if(this.stream)this.stream.destroy(),this.stream=null;this.log("Unable to receive incoming calls");setTimeout(function(){e.fire("ready",e)},0)}},connect:function(a){if(typeof a=="function")return this.addListener("connect",a);a=c(this,this.token,"jwt",a);this.connections.push(a);if(this.sounds.outgoing()){var b=this;a.accept(function(){b.soundcache.play("outgoing")})}a.accept();return a},disconnectAll:function(){if(typeof params=="function")return this.addListener("disconnectAll",
params);for(var a=[].concat(this.connections),b=0;b<a.length;b++)a[b].disconnect();this.connections.length>0&&this.log("Connections left pending: "+this.connections.length)},destroy:function(){this.stream.destroy();this.swf&&this.swf.disconnect&&this.swf.disconnect()},disconnect:function(a){this.addListener("disconnect",a)},incoming:function(a){this.addListener("incoming",a)},offline:function(a){this.addListener("offline",a)},ready:function(a){this.addListener("ready",a)},error:function(a){this.addListener("error",
a)},status:function(){return this._status}};e=function(a){var b=[],c=function(c){if(a.instance)return c();b.push(c)},h=function(b){b=(b.code?b.code+": ":"")+b.message;a.instance&&a.instance.log(b);throw new f.Exception(b);},i={instance:null,setup:function(c,g){if(!swfobject.hasFlashPlayerVersion("10.1.0"))throw new f.Exception("Flash 10.1.0 required.");if(a.instance)a.instance.log("Found existing Device; using new token but ignoring options"),a.instance.token=c,a.instance.register(c);else{a.instance=
new e(c,g);a.sounds=a.instance.sounds;for(var i=0;i<b.length;i++)b[i]();a.ready(function(){a.instance._status="ready"});a.offline(function(){a.instance._status="offline"});a.instance.connect(function(){a.instance._status="busy"});a.instance.disconnect(function(){a.instance._status="ready"});a.incoming(function(b){a.status()=="busy"&&(a.instance.log("Device busy; ignoring incoming invite"),b.cancel())});a.error(h)}return a},connect:function(b){if(typeof b=="function")c(function(){a.instance.addListener("connect",
b)});else{if(!a.instance)throw new f.Exception("Run Twilio.Device.setup()");if(a.instance.connections.length>0)a.instance.fire("error",{message:"A connection is currently active"});else return a.instance.connect(b)}},disconnectAll:function(){c(function(){a.instance.disconnectAll()});return a},disconnect:function(b){c(function(){a.instance.addListener("disconnect",b)});return a},status:function(){return a.instance._status},ready:function(b){c(function(){a.instance.addListener("ready",b)});return a},
error:function(b){c(function(){b!=h&&a.instance.removeListener("error",h);a.instance.addListener("error",b)});return a},offline:function(b){c(function(){a.instance.addListener("offline",b)});return a},incoming:function(b){c(function(){a.instance.addListener("incoming",b)});return a},destroy:function(){a.instance&&a.instance.destroy();return a},cancel:function(b){c(function(){a.instance.addListener("cancel",b)});return a}},n;for(n in i)a[n]=i[n];return a}(e);f.Device=e})(Twilio);
(function(){if(!window.WebSocket){var f=window.console;if(!f||!f.log||!f.error)f={log:function(){},error:function(){}};swfobject.hasFlashPlayerVersion("10.0.0")?(location.protocol=="file:"&&f.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(b,e,c,a,d){var f=this;f.__id=WebSocket.__nextId++;WebSocket.__instances[f.__id]=f;f.readyState=WebSocket.CONNECTING;f.bufferedAmount=
0;f.__events={};setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(f.__id,b,e,c||null,a||0,d||null)})},0)},WebSocket.prototype.send=function(b){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";b=WebSocket.__flash.send(this.__id,encodeURIComponent(b));return b<0?!0:(this.bufferedAmount+=b,!1)},WebSocket.prototype.close=function(){if(!(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING))this.readyState=
WebSocket.CLOSING,WebSocket.__flash.close(this.__id)},WebSocket.prototype.addEventListener=function(b,e){b in this.__events||(this.__events[b]=[]);this.__events[b].push(e)},WebSocket.prototype.removeEventListener=function(b,e){if(b in this.__events)for(var c=this.__events[b],a=c.length-1;a>=0;--a)if(c[a]===e){c.splice(a,1);break}},WebSocket.prototype.dispatchEvent=function(b){for(var e=this.__events[b.type]||[],c=0;c<e.length;++c)e[c](b);(e=this["on"+b.type])&&e(b)},WebSocket.prototype.__handleEvent=
function(b){if("readyState"in b)this.readyState=b.readyState;if(b.type=="open"||b.type=="error")b=this.__createSimpleEvent(b.type);else if(b.type=="close")b=this.__createSimpleEvent("close");else if(b.type=="message")b=this.__createMessageEvent("message",decodeURIComponent(b.message));else throw"unknown event type: "+b.type;this.dispatchEvent(b)},WebSocket.prototype.__createSimpleEvent=function(b){if(document.createEvent&&window.Event){var e=document.createEvent("Event");e.initEvent(b,!1,!1);return e}else return{type:b,
bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(b,e){if(document.createEvent&&window.MessageEvent&&!window.opera){var c=document.createEvent("MessageEvent");c.initMessageEvent("message",!1,!1,e,null,null,window,null);return c}else return{type:b,data:e,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=
function(b){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(b)})},WebSocket.__initialize=function(){if(!WebSocket.__flash){if(WebSocket.__swfLocation)window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation;if(window.WEB_SOCKET_SWF_LOCATION){var b=document.createElement("div");b.id="webSocketContainer";b.style.position="absolute";WebSocket.__isFlashLite()?(b.style.left="0px",b.style.top="0px"):(b.style.left="-100px",b.style.top="-100px");var e=document.createElement("div");e.id=
"webSocketFlash";b.appendChild(e);document.body.appendChild(b);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(b){b.success||f.error("[WebSocket] swfobject.embedSWF failed")})}else f.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf")}},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash");
WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var b=0;b<WebSocket.__tasks.length;++b)WebSocket.__tasks[b]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){setTimeout(function(){try{for(var b=WebSocket.__flash.receiveEvents(),e=0;e<b.length;++e)WebSocket.__instances[b[e].webSocketId].__handleEvent(b[e])}catch(c){f.error(c)}},0);return!0},WebSocket.__log=function(b){f.log(decodeURIComponent(b))},WebSocket.__error=function(b){f.error(decodeURIComponent(b))},
WebSocket.__addTask=function(b){WebSocket.__flash?b():WebSocket.__tasks.push(b)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var b=window.navigator.mimeTypes["application/x-shockwave-flash"];return!b||!b.enabledPlugin||!b.enabledPlugin.filename?!1:b.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",
function(){WebSocket.__initialize()}))):f.error("Flash Player >= 10.0.0 is required.")}})();
